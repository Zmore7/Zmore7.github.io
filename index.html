<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="HexoWorld" />










<meta name="description" content="优雅~">
<meta property="og:type" content="website">
<meta property="og:title" content="Zmore&#39;s黑板报">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Zmore&#39;s黑板报">
<meta property="og:description" content="优雅~">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zmore&#39;s黑板报">
<meta name="twitter:description" content="优雅~">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Zmore's黑板报</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zmore's黑板报</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-主页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            主页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            文章
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/07/xu-lie-hua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zmore">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmore's黑板报">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/07/xu-lie-hua/" itemprop="url">xu_lie_hua</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-07T23:06:24+08:00">
                2018-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h1><p>把复杂的数据类型压缩到一个字符串中<br><strong>serialize()</strong> 把变量和它们的值编码成文本形式<br><strong>unserialize()</strong> 恢复原先变量  </p>
<h4 id="1-创建一个-arr数组用于储存用户基本信息，并在浏览器中输出查看结果；"><a href="#1-创建一个-arr数组用于储存用户基本信息，并在浏览器中输出查看结果；" class="headerlink" title="1.创建一个$arr数组用于储存用户基本信息，并在浏览器中输出查看结果；"></a>1.创建一个$arr数组用于储存用户基本信息，并在浏览器中输出查看结果；</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; $arr=array();</span><br><span class="line">&gt; $arr[&apos;name&apos;]=&apos;张三&apos;;</span><br><span class="line">&gt; $arr[&apos;age&apos;]=&apos;22&apos;;</span><br><span class="line">&gt; $arr[&apos;sex&apos;]=&apos;男&apos;;</span><br><span class="line">&gt; $arr[&apos;phone&apos;]=&apos;123456789&apos;;</span><br><span class="line">&gt; $arr[&apos;address&apos;]=&apos;上海市浦东新区&apos;;</span><br><span class="line">&gt; var_dump($arr)；</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 输出结果：   </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">array(5) &#123; </span><br><span class="line">[&quot;name&quot;]=&gt; string(6) &quot;张三&quot; </span><br><span class="line">[&quot;age&quot;]=&gt; string(2) &quot;22&quot; </span><br><span class="line">[&quot;sex&quot;]=&gt; string(3) &quot;男&quot; </span><br><span class="line">[&quot;phone&quot;]=&gt; string(9) &quot;123456789&quot; </span><br><span class="line">[&quot;address&quot;]=&gt; string(21) &quot;上海市浦东新区&quot;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-将-arr数组进行序列化赋值给-info字符串，并在浏览器中输出查看结果"><a href="#2-将-arr数组进行序列化赋值给-info字符串，并在浏览器中输出查看结果" class="headerlink" title="2.将$arr数组进行序列化赋值给$info字符串，并在浏览器中输出查看结果"></a>2.将$arr数组进行序列化赋值给$info字符串，并在浏览器中输出查看结果</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$info=serialize($arr);</span><br><span class="line">var_dump($info);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>输出结果：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(140) &quot;a:5:&#123;s:4:&quot;name&quot;;s:6:&quot;张三&quot;;s:3:&quot;age&quot;;s:2:&quot;22&quot;;s:3:&quot;sex&quot;;s:3:&quot;男&quot;;s:5:&quot;phone&quot;;s:9:&quot;123456789&quot;;s:7:&quot;address&quot;;s:21:&quot;上海市浦东新区&quot;;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>使用序列化<br><strong>serialize($arr)</strong><br>函数，将数组中元素的键和值按照规则顺序连接成字符串。  </p>
<blockquote>
<p>a：5标志序列化为array包含5个键值对.<br>s：4标志内容为字符串包含4个字符。  </p>
</blockquote>
<p>通过序列化我们可以将一些模块化的数据使用字符串的形式存储在数据库或session等，可以减少创建众多繁琐的数据表字段，当然序列化为字符串存储会增加额外的空间，应合理的设计和应用。</p>
<h4 id="3-最后使用unserialize-info-反序列化将字符串还原成我们需要的数组模式"><a href="#3-最后使用unserialize-info-反序列化将字符串还原成我们需要的数组模式" class="headerlink" title="3.最后使用unserialize($info)反序列化将字符串还原成我们需要的数组模式"></a>3.最后使用unserialize($info)反序列化将字符串还原成我们需要的数组模式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$zhangsan=unserialize($info);</span><br><span class="line">var_dump($zhangsan);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>输出结果：</p>
</blockquote>
<p>实现了对数组的还原</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">array(5) &#123;</span><br><span class="line">[&quot;name&quot;]=&gt; string(6) &quot;张三&quot; </span><br><span class="line">[&quot;age&quot;]=&gt; string(2) &quot;22&quot; </span><br><span class="line">[&quot;sex&quot;]=&gt; string(3) &quot;男&quot; </span><br><span class="line">[&quot;phone&quot;]=&gt; string(9) &quot;123456789&quot; </span><br><span class="line">[&quot;address&quot;]=&gt; string(21) &quot;上海市浦东新区&quot; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="php序列化漏洞原理"><a href="#php序列化漏洞原理" class="headerlink" title="php序列化漏洞原理"></a>php序列化漏洞原理</h1><p>参考：<a href="https://www.cnblogs.com/perl6/p/7124345.html" target="_blank" rel="noopener">https://www.cnblogs.com/perl6/p/7124345.html</a></p>
<p>原理：</p>
<p>==函数<br><strong>unserialize()</strong><br>后会导致<br><strong>__wakeup()</strong><br>或<br><strong>__destruct()</strong><br>的直接调用，中间无需其他过程。因此最理想的情况就是一些漏洞/危害代码在<br><strong>__wakeup()</strong><br>或<br><strong>__destruct()</strong><br>中，从而当我们控制序列化字符串时可以去直接触发它们。==</p>
<p>对一个对象进行反序列化处理时<br>如果对象存在可控的参数<br>析构函数在每个对象结束时都会运行（也就是<strong>魔术方法</strong>）<br>传入一个不存在的参数<br>析构也会执行  </p>
<h6 id="在PHP中，-类被创建或消失后，-都会自动的执行某些函数，-如："><a href="#在PHP中，-类被创建或消失后，-都会自动的执行某些函数，-如：" class="headerlink" title="在PHP中， 类被创建或消失后， 都会自动的执行某些函数， 如："></a>在PHP中， 类被创建或消失后， 都会自动的执行某些函数， 如：</h6><blockquote>
<p><strong>construct()  
</strong>destruct()<br><strong>call()  
</strong>callStatic()<br><strong>get()   
</strong>set()<br><strong>isset()  
</strong>unset()<br><strong>sleep()   
</strong>wakeup()<br><strong>toString()   
</strong>invoke()<br><strong>set_state()   
</strong>clone()<br><strong>autoload()<br>Exception::</strong>toString<br>ErrorException::<strong>toString<br>DateTime::</strong>wakeup<br>ReflectionException::<strong>toString<br>ReflectionFunctionAbstract::</strong>toString<br>ReflectionFunction::<strong>toString<br>ReflectionParameter::</strong>toString<br>ReflectionMethod::<strong>toString<br>ReflectionClass::</strong>toString<br>ReflectionObject::<strong>toString<br>ReflectionProperty::</strong>toString<br>ReflectionExtension::<strong>toString<br>LogicException::</strong>toString<br>BadFunctionCallException::<strong>toString<br>BadMethodCallException::</strong>toString<br>DomainException::<strong>toString<br>InvalidArgumentException::</strong>toString<br>LengthException::<strong>toString<br>OutOfRangeException::</strong>toString<br>RuntimeException::__toString  </p>
</blockquote>
<p>所以这些都可以作为利用的方法    </p>
<h1 id="一个序列化应用"><a href="#一个序列化应用" class="headerlink" title="一个序列化应用"></a>一个序列化应用</h1><p>原文：<a href="http://foreversong.cn/archives/1326" target="_blank" rel="noopener">http://foreversong.cn/archives/1326</a>    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$user_data = @unserialize(base64_decode($_COOKIE[&apos;AshopToken&apos;]));</span><br></pre></td></tr></table></figure>
<p><strong>COOKIE[‘AshopToken’]</strong>  函数可控</p>
<p>在<strong>lib/class/picture.class.php</strong>中找到了  <strong>_wakeup</strong>函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function __wakeup() &#123;</span><br><span class="line">    echo file_get_contents($this-&gt;imgPath);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>新建一个picture的类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$poc = new picture(&apos;123&apos;,&apos;456&apos;);</span><br><span class="line">$poc-&gt;imgPath = &apos;/tmp/flag&apos;;</span><br><span class="line">$adog = base64_encode(serialize($poc));</span><br><span class="line">echo $adog;</span><br></pre></td></tr></table></figure>
<p>传入序列化后的cookie即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/26/Classical-cipher/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zmore">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmore's黑板报">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/26/Classical-cipher/" itemprop="url">Classical cipher</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-26T20:08:22+08:00">
                2018-10-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CTF古典密码："><a href="#CTF古典密码：" class="headerlink" title="CTF古典密码："></a>CTF古典密码：</h1><p>栅栏密码，置换密码，替代密码</p>
<h2 id="栅栏密码："><a href="#栅栏密码：" class="headerlink" title="栅栏密码："></a>栅栏密码：</h2><p>所谓栅栏密码，就是把要加密的明文分成N个一组，然后把每组的第1个字连起来，形成一段无规律的话。</p>
<p>举例子：</p>
<blockquote>
<p>两两分组<br>HELLO WORLD<br>——拿掉空格<br>HELLOWORLD<br>——两两分组<br>HE LL OW OR LD<br>    ——取首字母<br>HLOOL<br>ELWRD<br>    ——合并<br>密文：HLOOLELWRD</p>
</blockquote>
<blockquote>
<p>五五分组<br>HELLOWORLD<br>——五五分组<br>HELLO WORLD<br>    ——取首字母<br>HW<br>EO<br>LR<br>LL<br>OD<br>    ——合并<br>密文：HWEOLRLLOD</p>
</blockquote>
<h2 id="置换密码："><a href="#置换密码：" class="headerlink" title="置换密码："></a>置换密码：</h2><p>置换密码又称换位密码，是根据一定的规则重新排列明文，以便打破明文的结构特性。置换密码需要一个密匙来执行加密，密匙的位数就是加密矩阵的列数。</p>
<blockquote>
<p>举例子：<br>密匙：21543<br>HELLOWORLD<br>以密匙分列<br>2    1    5    4    3<br>H    E    L    L    O<br>W    O    R    L    D<br>整理顺序<br>1    2    3    4    5<br>E    H    O    L    L<br>O    W    D    L    R<br>即可得到密文：EHOLLOWDLR</p>
</blockquote>
<h2 id="替代密码"><a href="#替代密码" class="headerlink" title="替代密码"></a>替代密码</h2><p>替代密码是指先建立一个替换表，加密时将需要加密的明文依次通过查表，替换为相应的字符，明文字符被逐个替换后，生成无任何意义的字符串，即密文，替代密码的密钥就是其替换表 。</p>
<p>一种很简单的加密方式，只需要制作一个一对一的替代表即可完成。<br>可以参考：<a href="https://blog.csdn.net/chengqiuming/article/details/82077894" target="_blank" rel="noopener">https://blog.csdn.net/chengqiuming/article/details/82077894</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/aes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zmore">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmore's黑板报">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/aes/" itemprop="url">从简单加密到aes加密</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-23T22:09:43+08:00">
                2018-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一个普通的文件加密"><a href="#一个普通的文件加密" class="headerlink" title="一个普通的文件加密"></a>一个普通的文件加密</h2><p>实现对文本文件加密很简单，以fgetc()每次读取一个字符，按位取反实现简单的加密操作，然后通过fputc()每次写入一个字符到文件，就完成对文本文件的加密</p>
<p>打开一个需要加密的文本文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FILE *fp;</span><br><span class="line"></span><br><span class="line">fopen_s(&amp;fp, &quot;C:\\Users\\Zmore\\Desktop\\new.txt&quot;, &quot;rb+&quot;);</span><br></pre></td></tr></table></figure></p>
<p>创建一个加密后的文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FILE *temp;</span><br><span class="line"></span><br><span class="line">fopen_s(&amp;temp, &quot;C:\\Users\\Zmore\\Desktop\\new1.txt&quot;, &quot;wb+&quot;);</span><br></pre></td></tr></table></figure></p>
<p>文件的读取有二进制和文本读取两种方式，rb与wb即为二进制的方式读/写。</p>
<p>二进制读写的好处在于它会原封不动的保留文件内容</p>
<p>文本读写可能会转变部分字符</p>
<p>参考：<a href="https://www.cnblogs.com/litaozijin/p/6582048.html" target="_blank" rel="noopener">https://www.cnblogs.com/litaozijin/p/6582048.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">char tempChar= fgetc(fp);</span><br><span class="line"></span><br><span class="line">if (tempChar != 0 &amp;&amp; tempChar != -1)</span><br><span class="line"></span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line"> tempChar = ~tempChar;</span><br><span class="line"></span><br><span class="line"> fputc(tempChar, temp);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>这里读取每一个字符，对这些字符进行取反操作（~），并保存到文件，就实现了加密。</p>
<p>解密只需要对这个过程反转即可。</p>
<h2 id="Aes加密"><a href="#Aes加密" class="headerlink" title="Aes加密"></a>Aes加密</h2><p> Aes是一种非常常见的加密算法，采用的是对称加密，即存在一个密匙同时负责加密和解密数据，它的加密破解很难，所以现在很多的勒索软件采用该加密算法对受害者的数据加密。Aes有128，192，256位三种加密方式，这里以128位为例。</p>
<p>   <img src="http://upload-images.jianshu.io/upload_images/1329916-58fadbe8538142fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="介绍"></p>
<p>Aes加密的过程：字节替换，行位移，列混淆，加轮密匙</p>
<p>字节替换：<br><img src="http://upload-images.jianshu.io/upload_images/1329916-69fbeed7aebf5c2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="字节替换"></p>
<p>  将被加密文件以128bit（16字节）分割开，组成n个4X4的矩阵。对于这16个字节的文件，依据一个被称为<strong>S**</strong>盒** 的16X16大小的二维常量数组进行字节替换。</p>
<p>行位移：<br><img src="http://upload-images.jianshu.io/upload_images/1329916-927138b04b20e9c3.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="行位移"></p>
<p>  即对这16个字节组成的矩阵，每一行进行位移操作。</p>
<p>列混淆：<br><img src="http://upload-images.jianshu.io/upload_images/1329916-63bb013bf19b8555.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>  将行位移后的矩阵与一个固定的矩阵进行相乘操作，即可得到一个混淆后的新矩阵。</p>
<p>加轮密匙：<br><img src="http://upload-images.jianshu.io/upload_images/1329916-65217cc6e1463d7a.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>  与我们设置的加密密匙进行异或操作，从而得到新的矩阵。</p>
<p>经过上述步骤，我们得到了第一次加密的矩阵。128bit的密匙再进行九次这样的重复操作，每次的加轮密匙的每一个元素W[i]都是由W[i-4]和W[i-1]计算而来。如图</p>
<p>以上是一点粗浅的介绍，以下文章可以深入学习：</p>
<p><a href="https://blog.csdn.net/qq_28205153/article/details/55798628" target="_blank" rel="noopener">https://blog.csdn.net/qq_28205153/article/details/55798628</a></p>
<p><a href="https://www.sohu.com/a/200488301_478315" target="_blank" rel="noopener">https://www.sohu.com/a/200488301_478315</a></p>
<p><a href="http://www.cnblogs.com/block2016/p/5596676.html" target="_blank" rel="noopener">http://www.cnblogs.com/block2016/p/5596676.html</a></p>
<p>我们并不需要一步一步来走上述流程来实现aes加密，我们可以使用openssl库中的aes加密方法来简化操作。</p>
<p>准备工作：</p>
<ol>
<li><p>引用openssl库<a href="https://www.jb51.net/article/119025.htm" target="_blank" rel="noopener">https://www.jb51.net/article/119025.htm</a></p>
</li>
<li><p>C++的fstream的使用<a href="https://www.cnblogs.com/batman425/p/3179520.html" target="_blank" rel="noopener">https://www.cnblogs.com/batman425/p/3179520.html</a></p>
</li>
</ol>
<p>加密代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">// 准备32字节(256位)的AES密码字节</span><br><span class="line"></span><br><span class="line">  unsigned  char aes_keybuf[32];</span><br><span class="line"></span><br><span class="line">  AES_KEY aeskey;</span><br><span class="line"></span><br><span class="line"> memset(aes_keybuf, 0x00, sizeof(aes_keybuf));</span><br><span class="line"></span><br><span class="line"> memcpy(aes_keybuf, &quot;0123456789abcdef0123456789abcdef&quot;, AES_BLOCK_SIZE);</span><br><span class="line"></span><br><span class="line"> AES_set_encrypt_key(aes_keybuf, 256, &amp;aeskey);</span><br><span class="line"></span><br><span class="line">//打开文件</span><br><span class="line"></span><br><span class="line"> strcpy_s(inFileName, &quot;C:\\Users\\Zmore\\Desktop\\new.txt&quot;);</span><br><span class="line"></span><br><span class="line"> strcpy_s(outFileName, &quot;C:\\Users\\Zmore\\Desktop\\z.enc&quot;);</span><br><span class="line"></span><br><span class="line"> infileStream.open(inFileName, ifstream::binary | ifstream::in);//二进制打开</span><br><span class="line"></span><br><span class="line"> outfileStream.open(outFileName, ofstream::out | ofstream::binary);</span><br><span class="line"></span><br><span class="line">while (!infileStream.eof())</span><br><span class="line"></span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line">  unsigned  char buf[bufferLength];</span><br><span class="line"></span><br><span class="line">  unsigned  char buf2[bufferLength];</span><br><span class="line"></span><br><span class="line"> memset(buf, 0, 16);</span><br><span class="line"></span><br><span class="line"> memset(buf2, 0, 16);</span><br><span class="line"></span><br><span class="line"> infileStream.read((char *)buf, bufferLength);</span><br><span class="line"></span><br><span class="line">  int inCount = infileStream.gcount();//统计读取到的字符数</span><br><span class="line"></span><br><span class="line">  if (inCount == bufferLength)</span><br><span class="line"></span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line"> AES_encrypt(buf, buf2, &amp;aeskey);</span><br><span class="line"></span><br><span class="line"> outfileStream.write((char *)buf2, bufferLength);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">  else</span><br><span class="line"></span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line"> outfileStream.write((char *)buf, inCount);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>文件：</p>
<p><a href="https://github.com/Zmore7/Code/tree/master/aes" target="_blank" rel="noopener">https://github.com/Zmore7/Code/tree/master/aes</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/04/spider1-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zmore">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmore's黑板报">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/04/spider1-1/" itemprop="url">爬虫入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-04T20:58:03+08:00">
                2017-11-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>requests库用法<br>环境：windows10+python3.5<br>安装lxml解析：<strong>pip install lxml</strong><br>用pip安装requests库：<strong>pip install requests</strong></p>
<h2 id="简单的一个爬虫"><a href="#简单的一个爬虫" class="headerlink" title="简单的一个爬虫"></a>简单的一个爬虫</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">r=requests.get(&quot;http://www.baidu.com&quot;)</span><br><span class="line">r.encoding=&quot;utf-8&quot;</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
<p>逐行解读代码：</p>
<ul>
<li>import requests<br>引入requests库，这是实现requests爬虫的基础</li>
<li>requests.get()<br>放入url，就会返回一个response对象，包含了网页的内容、状态等信息，需要注意的是url必须带上“http://”</li>
<li>将其字符编码转换为utf-8格式『推荐这样的编码，不然很容易出现乱码的问题』</li>
<li>显示响应的文本内容，用utf-8编码后就可以显示中文字符</li>
</ul>
<h2 id="完善爬虫"><a href="#完善爬虫" class="headerlink" title="完善爬虫"></a>完善爬虫</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&apos;http://www.baidu.com&apos;</span><br><span class="line">r = requests.get(url)</span><br><span class="line">r.raise_for_status()</span><br><span class="line">print(r.status_code)</span><br><span class="line">r.encoding=r.apparent_encoding</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
<ul>
<li>r.raise_for_status()<br>用于获取状态码，如果网址错误会抛出异常的信息</li>
<li>r.status_code<br>就是响应体内的状态码信息，可以用print函数展示出来</li>
<li>r.encoding=r.apparent_encoding<br>将响应的编码改变为网页用的编码，如果网站内容有中文字符，那么直接使用他的编码就可以展示中文的内容了</li>
</ul>
<h2 id="带参数的爬虫"><a href="#带参数的爬虫" class="headerlink" title="带参数的爬虫"></a>带参数的爬虫</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">kv=&#123;&apos;value&apos;:&quot;keyword&quot;&#125;</span><br><span class="line">ua =&#123;&apos;user-agent&apos;:&apos;123&apos;&#125;</span><br><span class="line">url=&quot;http://httpbin.org/get&quot;</span><br><span class="line">try:</span><br><span class="line">    r=requests.get(url,params=kv,headers=ua)</span><br><span class="line">    r.encoding=r.apparent_encoding</span><br><span class="line">    print(r.text)</span><br><span class="line">except:</span><br><span class="line">    print(&apos;error&apos;)</span><br></pre></td></tr></table></figure>
<p>通过分析响应的内容,就可以看到我们传入的参数了</p>
<blockquote>
<p>“args”: {“value”: “keyword”}<br>另外，我们通过设定headers，改变了useragent信息，所以我们可以看到响应的以下信息<br>“User-Agent”: “123”<br>通过设定user-agent，我们可以改变用户浏览器等信息，防止某些网站根据这个内容判断我们是否为爬虫</p>
</blockquote>
<h2 id="查找ip地址的小例子"><a href="#查找ip地址的小例子" class="headerlink" title="查找ip地址的小例子"></a>查找ip地址的小例子</h2><p>beautifulsoup是一个非常方便的html解析工具<br>我们通过它可以解析查找我们想要的内容</p>
<blockquote>
<p>安装：pip install beautifulsoup</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">ip=input()</span><br><span class="line">url=&apos;http://m.ip138.com/ip.asp?ip=&apos;+ip</span><br><span class="line">r=requests.get(url)</span><br><span class="line">obs=BeautifulSoup(r.text,&quot;html.parser&quot;)</span><br><span class="line">q=obs.find_all(&apos;p&apos;)[-1].get_text()</span><br><span class="line">a=str(q).split(&apos;：&apos;)[-1]</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>
<p>from bs4 import BeautifulSoup先引入bs库<br>通过input()输入ip地址，传入url里<br>obs=BeautifulSoup(r.text,”html.parser”)建立一个beautifulsoup的对象<br>q=obs.find_all(‘p’)[-1].get_text()<br>找出最后的p标签并获取内容<br>a=str(q).split(‘：’)[-1]<br>因为内容是用：分开的<br>我们获取内容的最后一个用：分开的内容</p>
<p><strong>我们如何从响应中解析出来自己需要的内容呢</strong><br><strong>这就需要学习bs、正则、xpath等内容了</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/28/spider1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zmore">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmore's黑板报">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/28/spider1/" itemprop="url">爬取真正的下载地址</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-28T17:52:32+08:00">
                2017-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#太平洋的下载，爬取zip后缀的下载地址，可以迅雷直接下载</span><br><span class="line">import re</span><br><span class="line">import requests</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">url=input()</span><br><span class="line">#例如&quot;http://dl.pconline.com.cn/html_2/1/81/id=1322&amp;pn=0&amp;linkPage=1.html&quot;</span><br><span class="line">r = requests.get(url)</span><br><span class="line">r.encoding = r.apparent_encoding</span><br><span class="line">soup=BeautifulSoup(r.text,&quot;html.parser&quot;)</span><br><span class="line">pattern = re.compile(r&apos;.*?zip&apos;, re.S)</span><br><span class="line">for link in soup.find_all(&apos;a&apos;):</span><br><span class="line">    k = re.findall(pattern, str(link.get(&apos;tempurl&apos;)))</span><br><span class="line">#这个是里面zip的下载标签</span><br><span class="line">    if k !=[]:</span><br><span class="line">        print(k)</span><br></pre></td></tr></table></figure>
<p>提取链接直接放进迅雷里新建下载地址就行了<br>用网页打开会显示盗链的(-.-)</p>
<p>总结：<br>就是对requests和re库的一点运用<br>然后是beautifsoup对所有<code>&lt;a&gt;</code>标签的过滤<br>用正则匹配有zip下载的标签</p>
<p>下面是一些参考：<br><a href="http://www.cnblogs.com/pizitai/archive/2017/02/14/6398276.html" target="_blank" rel="noopener">http://www.cnblogs.com/pizitai/archive/2017/02/14/6398276.html</a><br><a href="http://bbs.csdn.net/topics/391011314?list=lz" target="_blank" rel="noopener">http://bbs.csdn.net/topics/391011314?list=lz</a>获取a标签内的某个属性<br><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014316724772904521142196b74a3f8abf93d8e97c6ee6000" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014316724772904521142196b74a3f8abf93d8e97c6ee6000</a> list的运用<br><a href="http://www.cnblogs.com/pizitai/archive/2017/02/14/6398276.html" target="_blank" rel="noopener">http://www.cnblogs.com/pizitai/archive/2017/02/14/6398276.html</a>三种遍历列表里面序号和值的方法</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/01/c-socket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zmore">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmore's黑板报">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/01/c-socket/" itemprop="url">c++ socket</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-01T20:51:10+08:00">
                2017-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>网上发现一些资源，想和同学共享，发现好像只能通过网络聊天工具传，心里好不舒服，萌生了一个点对点信息传播的想法，就开始了socket编程之路，借着清明节放假，写一下，还是小菜，看官多多见谅。。</p>
<p>另：用到书籍《windows网络编程》</p>
<h2 id="这个是服务端"><a href="#这个是服务端" class="headerlink" title="这个是服务端"></a>这个是服务端</h2><p>注释比较多，是tcp的，客户端和服务端差不多了，就没注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;iostream&gt;</span><br><span class="line">#include&lt;WinSock2.h&gt;</span><br><span class="line">#pragma comment (lib,&quot;ws2_32.lib&quot;)</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">	WSADATA wsd;</span><br><span class="line">	SOCKET sServer;</span><br><span class="line">	SOCKET sClient;</span><br><span class="line">	int errcode;</span><br><span class="line">	char buf[BUFSIZ];</span><br><span class="line">	//初始化套接字动态库</span><br><span class="line">	if (WSAStartup(MAKEWORD(2, 2), &amp;wsd) != 0)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;wsastrat failed&quot; &lt;&lt; endl;</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line">	//创建套接字</span><br><span class="line">	sServer = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span><br><span class="line">	if (sServer == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;create socket failed&quot; &lt;&lt; endl;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//设置服务器socket地址</span><br><span class="line">	SOCKADDR_IN addrServ;										//服务器地址</span><br><span class="line">	addrServ.sin_family = AF_INET;								//地址簇，常用就是这个，不变</span><br><span class="line">	addrServ.sin_port = htons(10086);							//监听端口</span><br><span class="line">	addrServ.sin_addr.S_un.S_addr = INADDR_ANY;     //在任意本地端口监听</span><br><span class="line"></span><br><span class="line">	errcode = bind(sServer, (sockaddr*)&amp;addrServ, sizeof(SOCKADDR_IN));</span><br><span class="line">	//绑定 socket，服务器地址，地址长度</span><br><span class="line">	if (SOCKET_ERROR == errcode)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;bind failed&quot; &lt;&lt; endl;</span><br><span class="line">		closesocket(sServer);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//监听</span><br><span class="line">	errcode = listen(sServer, 1);</span><br><span class="line">	//监听服务器，等待队列</span><br><span class="line">	if (errcode == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;listen error&quot; &lt;&lt; endl;</span><br><span class="line">		closesocket(sServer);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; &quot;等待连接&quot; &lt;&lt; endl;</span><br><span class="line">	//accept接受数据</span><br><span class="line">	sockaddr_in addrClient;</span><br><span class="line">	int addrClientlen = sizeof(addrClient);</span><br><span class="line">	sClient = accept(sServer,(sockaddr FAR*)&amp;addrClient,&amp;addrClientlen);</span><br><span class="line">	if (INVALID_SOCKET==sClient)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;accept failed&quot; &lt;&lt; endl;</span><br><span class="line">		closesocket(sServer);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line">	//循环接受客户端的数据，发出quit后退出</span><br><span class="line">	while (true)</span><br><span class="line">	&#123;</span><br><span class="line">		ZeroMemory(buf,BUFSIZ);</span><br><span class="line">		errcode = recv(sClient,buf,BUFSIZ,0);//接收客户端内容</span><br><span class="line">		if (SOCKET_ERROR==errcode)</span><br><span class="line">		&#123;</span><br><span class="line">			cout &lt;&lt; &quot;recv failed&quot; &lt;&lt; endl;</span><br><span class="line">			closesocket(sServer);</span><br><span class="line">			closesocket(sClient);</span><br><span class="line">			WSACleanup();</span><br><span class="line">			return -1;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (strcmp(buf,&quot;quit&quot;)==0)</span><br><span class="line">		&#123;</span><br><span class="line">			errcode = send(sClient,&quot;quit&quot;,strlen(&quot;quit&quot;),0);//返回给客户端一个quit</span><br><span class="line">			//服务端socket，数据，数据长度，0</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		cout &lt;&lt; &quot;接收的数据：&quot; &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line">		</span><br><span class="line">		cout &lt;&lt; &quot;返回数据:&quot; &lt;&lt; endl;</span><br><span class="line">		char msg[BUFSIZ];</span><br><span class="line">		cin &gt;&gt; msg;</span><br><span class="line">		errcode = send(sClient,msg,strlen(msg),0);//返回服务端给客户端的数据</span><br><span class="line">		if (SOCKET_ERROR==errcode)</span><br><span class="line">		&#123;</span><br><span class="line">			cout &lt;&lt; &quot;send failed&quot; &lt;&lt; endl;</span><br><span class="line">			closesocket(sServer);</span><br><span class="line">			closesocket(sClient);</span><br><span class="line">			WSACleanup();</span><br><span class="line">			return -1;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	closesocket(sServer);</span><br><span class="line">	closesocket(sClient);</span><br><span class="line">	WSACleanup();</span><br><span class="line"></span><br><span class="line">	getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="下面是客户端"><a href="#下面是客户端" class="headerlink" title="下面是客户端"></a>下面是客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;iostream&gt;</span><br><span class="line">#include&lt;WinSock2.h&gt;</span><br><span class="line">#pragma comment (lib,&quot;ws2_32.lib&quot;)</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">	WSADATA wsd;</span><br><span class="line">	SOCKET sHost;</span><br><span class="line">	SOCKADDR_IN servAddr;</span><br><span class="line">	char buf[BUFSIZ];</span><br><span class="line">	int errcode;</span><br><span class="line"></span><br><span class="line">	if (WSAStartup(MAKEWORD(2,2),&amp;wsd)!=0)</span><br><span class="line">	&#123;	</span><br><span class="line">		cout &lt;&lt; &quot;wsastartup failed&quot; &lt;&lt; endl;</span><br><span class="line">		return -1;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	sHost = socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);</span><br><span class="line"></span><br><span class="line">	if (sHost == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;socket failed&quot; &lt;&lt; endl;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		return - 1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	servAddr.sin_family = AF_INET;</span><br><span class="line">	servAddr.sin_addr.S_un.S_addr = inet_addr(&quot;localhost&quot;);</span><br><span class="line">	servAddr.sin_port = htons(10086);</span><br><span class="line">	int sServerAddlen = sizeof(servAddr);</span><br><span class="line">	</span><br><span class="line">	errcode = connect(sHost, (LPSOCKADDR)&amp;servAddr, sizeof(servAddr));</span><br><span class="line">	if (SOCKET_ERROR==errcode)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;connect error&quot; &lt;&lt; endl;</span><br><span class="line">		closesocket(sHost);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		</span><br><span class="line">		return -1;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	while (true)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; &quot;发送数据：&quot; &lt;&lt; endl;</span><br><span class="line">		</span><br><span class="line">		cin &gt;&gt; buf;</span><br><span class="line">		errcode = send(sHost, buf, strlen(buf), 0);</span><br><span class="line">		if (SOCKET_ERROR==errcode)</span><br><span class="line">		&#123;</span><br><span class="line">			cout &lt;&lt; &quot;send failed&quot; &lt;&lt; endl;</span><br><span class="line">			closesocket(sHost);</span><br><span class="line">			WSACleanup();</span><br><span class="line">			return -1;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		errcode = recv(sHost,buf,sizeof(buf)+1,0);</span><br><span class="line">		cout &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">		if (strcmp(buf, &quot;quit&quot;) == 0)</span><br><span class="line">		&#123;</span><br><span class="line">			cout &lt;&lt; &quot;quit&quot; &lt;&lt; endl;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	closesocket(sHost);</span><br><span class="line">	WSACleanup();</span><br><span class="line">	getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Zmore" />
            
              <p class="site-author-name" itemprop="name">Zmore</p>
              <p class="site-description motion-element" itemprop="description">优雅~</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Zmore7" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zmore7@126.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zmore</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
